name: ğŸš€ Deploy website on push

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ğŸšš Get latest code
      uses: actions/checkout@v2.3.2

    - name: ğŸ“¦ Setup Node
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: ğŸ“¦ Compile css and javascript
      run: |
        npm install
        npm run prod

    - name: ğŸ” Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, ctype, iconv, intl, pdo_mysql
        coverage: none

    - name: ğŸ“¦ Install Composer Dependencies
      run: composer install --no-dev --optimize-autoloader

    - name: ğŸ”„ Generate Key
      run: php artisan key:generate --force

    - name: ğŸšš Optimize
      run: |
        php artisan optimize
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache

    - name: ğŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@4.0.0
      with:
        server: ftp.najmulhasan.xyz
        username: najmulha
        password: o@V1uL9jRF0-o
        server-dir: /public_html/
