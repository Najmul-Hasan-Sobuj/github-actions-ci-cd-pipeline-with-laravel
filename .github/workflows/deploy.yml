# .github/workflows/laravel-ci-cd.yml

# Define the name of the workflow
name: Laravel CI/CD

# Specify the events that trigger the workflow
on:
  push:
    branches:
      - main  # Trigger the workflow on push to the main branch
  pull_request:
    branches:
      - main  # Trigger the workflow on pull requests to the main branch

# Define the jobs to run
jobs:
  # The build job
  build:
    runs-on: ubuntu-latest  # Use the latest Ubuntu environment

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3  # Check out the repository code

      - name: Set up PHP
        uses: shivammathur/setup-php@v2  # Set up the specified PHP version
        with:
          php-version: '8.1'  # Specify the PHP version you are using

      - name: Install Composer dependencies
        run: composer install --prefer-dist --no-progress --no-suggest --ignore-platform-reqs  # Install Laravel dependencies

      - name: Copy .env.example to .env
        run: cp .env.example .env  # Copy the example environment file to .env

      - name: Generate application key
        run: php artisan key:generate  # Generate a new application key

      - name: Create storage symlink
        run: php artisan storage:link  # Create a symbolic link to the storage directory

      # - name: Run database migrations
      #   run: php artisan migrate --force  # Apply database migrations

      - name: Install Node.js
        uses: actions/setup-node@v3  # Set up the specified Node.js version
        with:
          node-version: '16'  # Specify the Node.js version you are using

      # - name: Install NPM dependencies
      #   run: npm install  # Install frontend dependencies

      # - name: Build assets
      #   run: npm run production  # Build production assets

      # - name: Run tests
      #   run: php artisan test  # Run Laravel tests

  # The deploy job
  deploy:
    runs-on: ubuntu-latest  # Use the latest Ubuntu environment
    needs: build  # This job depends on the successful completion of the build job
    if: github.ref == 'refs/heads/main'  
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3  # Check out the repository code

      - name: Set up SSH
        uses: webfactory/ssh-agent@v0.5.3  # Set up SSH for deployment
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}  # Use the SSH private key from GitHub Secrets

      - name: Copy files via SCP
        run: scp -r * najmulha@najmulhasan.xyz:public_html  # Copy the files to the server via SCP

      - name: SSH into server and deploy
        run: |
          ssh najmulha@najmulhasan.xyz << 'EOF'
          cd public_html
          composer install --prefer-dist --no-progress --no-suggest --ignore-platform-reqs  # Install Laravel dependencies on the server
          php artisan migrate --force  # Apply database migrations on the server
          php artisan config:cache  # Cache the configuration
          php artisan route:cache  # Cache the routes
          php artisan view:cache  # Cache the views
          npm install  # Install frontend dependencies on the server
          npm run production  # Build production assets on the server
          sudo systemctl restart apache2  # Restart the web server (adjust if using a different web server)
          EOF


    





#           ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMw36QStSLVHyOAAI4tyv7LurJjEuXrhNv7slEvQFPt8hlMlhCxwiqu0X67cNVSYeIS14YZctg3jbBsLZFrqnvZ6dPdWn9BAUPMMZJzR0wlmgEAlLJx//jmxc2a2o9mSWzhR61HrXXS3BU6jyTUonj3b+zDfxyohHihp7ArS9h8lADJydCQXVLklqvgP1/kKf3sJ2tL83Xp+vHIPMCo+PsZSyi2ZA5vBP/tUE+wzwaegpBO0e3ggc1X7I0aa8ekrlt/9o44sYG8fAnnG/KPlP/mrzjAZQRao1g+5DhNlIVrTzV93OhtrNz21iseTLzEfh2rph6+lqKUt6RzL+PKZcoAnkGwHC3Z+kXUJDyf6PX7TIiP70l91u3Mnt0iIkIjGrUowMqErLIhkhUJRMe/58y1lVIeZZbkOAe5SX6FXJG565gnh9NS68C2aRtHe5gIETdW2gwZJMaOhXXm92vy9uvg0TS3aFd9Lt1lqFMg7LFq+Mqbnie9fA8WFsHfd7agzcs5TJ4cs2NH0URMyBijIECp5TEPO+32HYjwAklGxswBURyJMBYJuHV1a0m6J0JXew50bIbUYqXUlWDN7y8eACOcrgrIyJuyn6BFFhKfd9r+df8CwG+yU9ZjL8CB5QhjjSdnBjZkezoWLQoDXoDGftF5eCIdS8V0Uf1SJNVNDga1Q== najmul35-2581@diu.edu.bd




#           b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAACFwAAAAdzc2gtcn
# NhAAAAAwEAAQAAAgEAzMN+kErUi1R8jgACOLcr+y7qyYxLl64Tb+7JRL0BT7fIZTJYQscI
# qrtF+u3DVUmHiEteGGXLYN42wbC2Ra6p72enT3Vp/QQFDzDGSc0dMJZoBAJSycf/45sXNm
# tqPZkls4UetR6110twVOo8k1KJ492/sw38cqIR4oaewK0vYfJQAycnQkF1S5Jar4D9f5Cn
# 97CdrS/N16frxyDzAqPj7GUsotmQObwT/7VBPsM8GnoKQTtHt4IHNV+yNGmvHpK5bf/aOO
# LGBvHwJ5xvyj5T/5q84wGUEWqNYPuQ4TZSFa081fdzobazc9tYrHky8xH4dq6YevpailLe
# kcy/jymXKAJ5BsBwt2fpF1CQ8n+j1+0yIj+9JfdbtzJ7dIiJCIxq1KMDKhKyyIZIVCUTHv
# +fMtZVSHmWW5DgHuUl+hVyRueuYJ4fTUuvAtmkbR3uYCBE3VtoMGSTGjoV15vdr8vbr4NE
# 0t2hXfS7dZahTIOyxavjKm54nvXwPFhbB33e2oM3LOUyeHLNjR9FETMgYoyBAqeUxDzvt9
# h2I8AJJRsbMAVEciTAWCbh1dWtJuidCV3sOdGyG1GKl1JVgze8vHgAjnK4KyMibsp+gRRY
# Sn3fa/nX/AsBvslPWYy/AgeUIY40nZwY2ZHs6Fi0KA16Axn7ReXgiHUvFdFH9UiTVTQ4Gt
# UAAAdQZreCo2a3gqMAAAAHc3NoLXJzYQAAAgEAzMN+kErUi1R8jgACOLcr+y7qyYxLl64T
# b+7JRL0BT7fIZTJYQscIqrtF+u3DVUmHiEteGGXLYN42wbC2Ra6p72enT3Vp/QQFDzDGSc
# 0dMJZoBAJSycf/45sXNmtqPZkls4UetR6110twVOo8k1KJ492/sw38cqIR4oaewK0vYfJQ
# AycnQkF1S5Jar4D9f5Cn97CdrS/N16frxyDzAqPj7GUsotmQObwT/7VBPsM8GnoKQTtHt4
# IHNV+yNGmvHpK5bf/aOOLGBvHwJ5xvyj5T/5q84wGUEWqNYPuQ4TZSFa081fdzobazc9tY
# rHky8xH4dq6YevpailLekcy/jymXKAJ5BsBwt2fpF1CQ8n+j1+0yIj+9JfdbtzJ7dIiJCI
# xq1KMDKhKyyIZIVCUTHv+fMtZVSHmWW5DgHuUl+hVyRueuYJ4fTUuvAtmkbR3uYCBE3Vto
# MGSTGjoV15vdr8vbr4NE0t2hXfS7dZahTIOyxavjKm54nvXwPFhbB33e2oM3LOUyeHLNjR
# 9FETMgYoyBAqeUxDzvt9h2I8AJJRsbMAVEciTAWCbh1dWtJuidCV3sOdGyG1GKl1JVgze8
# vHgAjnK4KyMibsp+gRRYSn3fa/nX/AsBvslPWYy/AgeUIY40nZwY2ZHs6Fi0KA16Axn7Re
# XgiHUvFdFH9UiTVTQ4GtUAAAADAQABAAACAQDKTgQHr8ca+Zgt+9g2DNOJUitqghBVhgly
# N6vnHA3loyB8yybkoxzvAiP77VlmNEWR5VTMKhasWCAlceBELHN9Mx3cpZbYAla1UW03kU
# 3bqV6PR3RgJBev2pUukSXgQiU7nrReIj9qvP/5BYxfydauqXIzCAh5gaLF+ldy6ii8Ttm6
# o75n+aBXz/uFFp5eoJ8zWu4OJALtpNyQWv99hks0Timxo96ZDDd+Fqilx+LkDdt/43/R0M
# gqdaftnNUGEdTe1z/VoEgiqHqryCWy3a3EBi/E4NRX+LxCK4pS2IZ1IDnQ9LDr/0SBnR+Z
# GA28le6z44CHUD6QF5wK1Q4V9fN+ML7SO17XrrNfzkmIgagy4Efgl388M4bkxGNlQFO+I5
# pzeImoDI/fLOhzA43kNEA26RVHsmGsboLdCCGKx7anCOSbFzqP8ybciDP66dFlsoRt/9E1
# CNTu0NTPsiGo9A+kiN5FRdGm1xNKn3uttHic4OfKOnP2TMfC0kD+F85IiR0z4rY8+Pu+zn
# 1G3l17XVRqNLu+YZS2DEt4ESmtZJkz2h+J49vXf62BnU3lGHrG5jOXzf+hjTwmZxJ8mtJR
# 1IZflJkCyEWmvThfTyU9YKtXWXE8ijEKkFI+1phbrNwm8c/MQgRi+uiwGKTokvCA/MZr/8
# qHC3g1mKq5RYytt0+dKQAAAQEA5TfIR/et02ofK+cEpq7y60E9Lpr62F8TCvUoSJbKkg1V
# PhARV7yFxYfu61PmWyWO9+XnpMAHlrpxBm9cJ82rcJOGfLmlKafSEdBqUGidkCN8ZrO0gh
# mBNcMfvUx793pkEthoOEgSr69+T0dqaSlXt4wrnGZhK5JvyFUWTSVQgy8S2ybcV8BU7nMe
# B78DuOYhKdnuV/n54XRZdKgS+a5g3M8zNuQcyhY2R/Bmw32LqmWZBfcH3UaOKdzruPWPra
# w4iQsm4Dhv+5TTwvBCJxQTe91Sk7qBufg3lUIKhSkRNhkmzziHlKfYHFMNBUsYKFUsuQ1K
# pW6NJYBvEQky3z6kbwAAAQEA9ILKeK7p1yB6WXry0pOh0alKcrNxVnp8xbmcFWg3D1ftIM
# tZj6cDe19aZtSWQqoyQCeMT3QUpiPCzmDdOzZuYndZsBNHImxCYuR1JNrknZsOmsbJH6fi
# ByjMCOXiFC3OtoUh1BZJ56soSYJ7CI03D2mfmLD9uzKH2F2z729PU0yEFSCfUOj4HXjU9i
# PMP8Pz6VLKb178yUqisysHWRrXFQmJWoI/TtbLewXgnKvUvS8Sqb9+Y2H6UYS8mKsa8f/b
# Rqt8slDIU/kVDggLpkfQq6Y0jUA+5Om8arFKSVjG+bppuCwGDYjVbBGWdzE0Nq2ot6fBKA
# 1GE9fX9ty5scF05wAAAQEA1mKV+PLC1EbH1QogbnE9e7NZb69BN8VqvdKUL9EocLJP3aNg
# K+hOa+043AcSsmQkqaVQiAEeS9Uuwpod7kn9Mka9L8w/KpH1+fxkYBuCpKYGn+3K9PO6rc
# abBncPWXgG3RsbkozOs2jnpDfvaOMtdKigQ1PIy3oHG5tOQVyGc/voxop3yctf0kQ3Qg3L
# ZvfPmTxbcAJkaB0SYG7x3vq5OIV5t9HM+5s5wWEqpKm7zs4ZLXAIdXBDWlbASlKCEJHxAO
# urtST/WpJ/pQkFpA6o0OR6KuuWXAQSfYlnOczrthy61GqQk5D/2sCowZKjpUGz1ZAKYxwI
# 8C2VGzlbsIa+4wAAABhuYWptdWwzNS0yNTgxQGRpdS5lZHUuYmQB
# -----END OPENSSH PRIVATE KEY-----
# [najmulha@srv1 ~]$
# [najmulha@srv1 ~]$ cat ~/.ssh/id_rsa
# -----BEGIN OPENSSH PRIVATE KEY-----
# b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAACFwAAAAdzc2gtcn
# NhAAAAAwEAAQAAAgEAzMN+kErUi1R8jgACOLcr+y7qyYxLl64Tb+7JRL0BT7fIZTJYQscI
# qrtF+u3DVUmHiEteGGXLYN42wbC2Ra6p72enT3Vp/QQFDzDGSc0dMJZoBAJSycf/45sXNm
# tqPZkls4UetR6110twVOo8k1KJ492/sw38cqIR4oaewK0vYfJQAycnQkF1S5Jar4D9f5Cn
# 97CdrS/N16frxyDzAqPj7GUsotmQObwT/7VBPsM8GnoKQTtHt4IHNV+yNGmvHpK5bf/aOO
# LGBvHwJ5xvyj5T/5q84wGUEWqNYPuQ4TZSFa081fdzobazc9tYrHky8xH4dq6YevpailLe
# kcy/jymXKAJ5BsBwt2fpF1CQ8n+j1+0yIj+9JfdbtzJ7dIiJCIxq1KMDKhKyyIZIVCUTHv
# +fMtZVSHmWW5DgHuUl+hVyRueuYJ4fTUuvAtmkbR3uYCBE3VtoMGSTGjoV15vdr8vbr4NE
# 0t2hXfS7dZahTIOyxavjKm54nvXwPFhbB33e2oM3LOUyeHLNjR9FETMgYoyBAqeUxDzvt9
# h2I8AJJRsbMAVEciTAWCbh1dWtJuidCV3sOdGyG1GKl1JVgze8vHgAjnK4KyMibsp+gRRY
# Sn3fa/nX/AsBvslPWYy/AgeUIY40nZwY2ZHs6Fi0KA16Axn7ReXgiHUvFdFH9UiTVTQ4Gt
# UAAAdQZreCo2a3gqMAAAAHc3NoLXJzYQAAAgEAzMN+kErUi1R8jgACOLcr+y7qyYxLl64T
# b+7JRL0BT7fIZTJYQscIqrtF+u3DVUmHiEteGGXLYN42wbC2Ra6p72enT3Vp/QQFDzDGSc
# 0dMJZoBAJSycf/45sXNmtqPZkls4UetR6110twVOo8k1KJ492/sw38cqIR4oaewK0vYfJQ
# AycnQkF1S5Jar4D9f5Cn97CdrS/N16frxyDzAqPj7GUsotmQObwT/7VBPsM8GnoKQTtHt4
# IHNV+yNGmvHpK5bf/aOOLGBvHwJ5xvyj5T/5q84wGUEWqNYPuQ4TZSFa081fdzobazc9tY
# rHky8xH4dq6YevpailLekcy/jymXKAJ5BsBwt2fpF1CQ8n+j1+0yIj+9JfdbtzJ7dIiJCI
# xq1KMDKhKyyIZIVCUTHv+fMtZVSHmWW5DgHuUl+hVyRueuYJ4fTUuvAtmkbR3uYCBE3Vto
# MGSTGjoV15vdr8vbr4NE0t2hXfS7dZahTIOyxavjKm54nvXwPFhbB33e2oM3LOUyeHLNjR
# 9FETMgYoyBAqeUxDzvt9h2I8AJJRsbMAVEciTAWCbh1dWtJuidCV3sOdGyG1GKl1JVgze8
# vHgAjnK4KyMibsp+gRRYSn3fa/nX/AsBvslPWYy/AgeUIY40nZwY2ZHs6Fi0KA16Axn7Re
# XgiHUvFdFH9UiTVTQ4GtUAAAADAQABAAACAQDKTgQHr8ca+Zgt+9g2DNOJUitqghBVhgly
# N6vnHA3loyB8yybkoxzvAiP77VlmNEWR5VTMKhasWCAlceBELHN9Mx3cpZbYAla1UW03kU
# 3bqV6PR3RgJBev2pUukSXgQiU7nrReIj9qvP/5BYxfydauqXIzCAh5gaLF+ldy6ii8Ttm6
# o75n+aBXz/uFFp5eoJ8zWu4OJALtpNyQWv99hks0Timxo96ZDDd+Fqilx+LkDdt/43/R0M
# gqdaftnNUGEdTe1z/VoEgiqHqryCWy3a3EBi/E4NRX+LxCK4pS2IZ1IDnQ9LDr/0SBnR+Z
# GA28le6z44CHUD6QF5wK1Q4V9fN+ML7SO17XrrNfzkmIgagy4Efgl388M4bkxGNlQFO+I5
# pzeImoDI/fLOhzA43kNEA26RVHsmGsboLdCCGKx7anCOSbFzqP8ybciDP66dFlsoRt/9E1
# CNTu0NTPsiGo9A+kiN5FRdGm1xNKn3uttHic4OfKOnP2TMfC0kD+F85IiR0z4rY8+Pu+zn
# 1G3l17XVRqNLu+YZS2DEt4ESmtZJkz2h+J49vXf62BnU3lGHrG5jOXzf+hjTwmZxJ8mtJR
# 1IZflJkCyEWmvThfTyU9YKtXWXE8ijEKkFI+1phbrNwm8c/MQgRi+uiwGKTokvCA/MZr/8
# qHC3g1mKq5RYytt0+dKQAAAQEA5TfIR/et02ofK+cEpq7y60E9Lpr62F8TCvUoSJbKkg1V
# PhARV7yFxYfu61PmWyWO9+XnpMAHlrpxBm9cJ82rcJOGfLmlKafSEdBqUGidkCN8ZrO0gh
# mBNcMfvUx793pkEthoOEgSr69+T0dqaSlXt4wrnGZhK5JvyFUWTSVQgy8S2ybcV8BU7nMe
# B78DuOYhKdnuV/n54XRZdKgS+a5g3M8zNuQcyhY2R/Bmw32LqmWZBfcH3UaOKdzruPWPra
# w4iQsm4Dhv+5TTwvBCJxQTe91Sk7qBufg3lUIKhSkRNhkmzziHlKfYHFMNBUsYKFUsuQ1K
# pW6NJYBvEQky3z6kbwAAAQEA9ILKeK7p1yB6WXry0pOh0alKcrNxVnp8xbmcFWg3D1ftIM
# tZj6cDe19aZtSWQqoyQCeMT3QUpiPCzmDdOzZuYndZsBNHImxCYuR1JNrknZsOmsbJH6fi
# ByjMCOXiFC3OtoUh1BZJ56soSYJ7CI03D2mfmLD9uzKH2F2z729PU0yEFSCfUOj4HXjU9i
# PMP8Pz6VLKb178yUqisysHWRrXFQmJWoI/TtbLewXgnKvUvS8Sqb9+Y2H6UYS8mKsa8f/b
# Rqt8slDIU/kVDggLpkfQq6Y0jUA+5Om8arFKSVjG+bppuCwGDYjVbBGWdzE0Nq2ot6fBKA
# 1GE9fX9ty5scF05wAAAQEA1mKV+PLC1EbH1QogbnE9e7NZb69BN8VqvdKUL9EocLJP3aNg
# K+hOa+043AcSsmQkqaVQiAEeS9Uuwpod7kn9Mka9L8w/KpH1+fxkYBuCpKYGn+3K9PO6rc
# abBncPWXgG3RsbkozOs2jnpDfvaOMtdKigQ1PIy3oHG5tOQVyGc/voxop3yctf0kQ3Qg3L
# ZvfPmTxbcAJkaB0SYG7x3vq5OIV5t9HM+5s5wWEqpKm7zs4ZLXAIdXBDWlbASlKCEJHxAO
# urtST/WpJ/pQkFpA6o0OR6KuuWXAQSfYlnOczrthy61GqQk5D/2sCowZKjpUGz1ZAKYxwI
# 8C2VGzlbsIa+4wAAABhuYWptdWwzNS0yNTgxQGRpdS5lZHUuYmQB

# najmulhasan.xyz 